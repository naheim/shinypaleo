10*8
plot(1:10)
x <- 12
shiny::runApp('Documents/shinypaleo/macrostrat')
shiny::runApp()
runApp()
pkg.uri <- URLencode(paste0("https://macrostrat.org/api/sections?project_id=","1,7","&lith_class=sedimentary","&environ_class=","&interval_name=Phanerozoic&format=csv"))
pkg.uri
packages <- read.csv(file=pkg.uri, header=TRUE)
head(packages)
max(table(packages$section_id))
sections <- paste(unique(packages$section_id), collapse=",")
sections
sect.ids <- paste(unique(packages$section_id), collapse=",")
proj.id <- "1,7"
env.call <- paste0("&environ_class=",input$enviro)
env.call <- paste0("&environ_class=","marine")
units.uri <- URLencode(paste0("https://macrostrat.org/api/units?lith_class=sedimentary&",env.call,"&section_id=",sect.ids,"&format=csv"))
env.call
units.uri
units.uri <- URLencode(paste0("https://macrostrat.org/api/units?lith_class=sedimentary",env.call,"&section_id=",sect.ids,"&format=csv"))
units <- read.csv(file=units.uri, header=TRUE)
head(units)
unit.ids <- paste(unique(units$unit_id), collapse=",")
pbdb.uri <- URLencode(paste0("https://macrostrat.org/api/fossils?unit_id=",unit.ids,"&format=csv"))
fossils <- read.csv(file=pbdb.uri, header=TRUE)
pbdb.uri
pbdb.uri <- URLencode(paste0("https://macrostrat.org/api/fossils?unit_id=",unit.ids,"&format=csv"))
fossils <- read.csv(file=pbdb.uri, header=TRUE)
pbdb.uri <- URLencode(paste0("https://macrostrat.org/api/fossils?lith_class=sedimentary",env.call,"&section_id=",sect.ids,"&format=csv"))
fossils <- read.csv(file=pbdb.uri, header=TRUE)
head(fossils)
nrow(fossils)
head(units)
URLencode("https://macrostrat.org/api/defs/intervals?timescale=New Zealand&format=csv")
runApp()
head(packages)
runApp()
summaryData <- data.frame('interval'=timescale$name, 'ageMid'=apply(cbind(timescale$b_age, timescale$t_age), 1, mean), 'nPkg'=NA, 'nColl'=NA, 'nFossiliferous'=NA, 'nTrunc'=NA, 'nInit'=NA)
for(i in 1:nBins) {
tempPkg <- subset(packages.marine, b_age > timescale$t_age[i] & t_age < timescale$b_age[i])
summaryData$nPkg[i] <- nrow(tempPkg)
summaryData$nColl[i] <- sum(tempPkg$pbdb_collections)
summaryData$nFossiliferous[i] <- nrow(subset(tempPkg, pbdb_collections > 0))
tempTrunc <- subset(tempPkg, t_age >= timescale$t_age[i] & t_age < timescale$b_age[i])
summaryData$nTrunc[i] <- nrow(tempTrunc)
tempInit <- subset(tempPkg, b_age > timescale$t_age[i] & b_age <= timescale$b_age[i])
summaryData$nInit[i] <- nrow(tempInit)
}
timescale <- read.csv(file=URLencode("https://macrostrat.org/api/defs/intervals?timescale=international ages&format=csv"), header=TRUE)
nBins <- nrow(timescale)
summaryData <- data.frame('interval'=timescale$name, 'ageMid'=apply(cbind(timescale$b_age, timescale$t_age), 1, mean), 'nPkg'=NA, 'nColl'=NA, 'nFossiliferous'=NA, 'nTrunc'=NA, 'nInit'=NA)
for(i in 1:nBins) {
tempPkg <- subset(packages.marine, b_age > timescale$t_age[i] & t_age < timescale$b_age[i])
summaryData$nPkg[i] <- nrow(tempPkg)
summaryData$nColl[i] <- sum(tempPkg$pbdb_collections)
summaryData$nFossiliferous[i] <- nrow(subset(tempPkg, pbdb_collections > 0))
tempTrunc <- subset(tempPkg, t_age >= timescale$t_age[i] & t_age < timescale$b_age[i])
summaryData$nTrunc[i] <- nrow(tempTrunc)
tempInit <- subset(tempPkg, b_age > timescale$t_age[i] & b_age <= timescale$b_age[i])
summaryData$nInit[i] <- nrow(tempInit)
}
i
summaryData <- data.frame('interval'=timescale$name, 'ageMid'=apply(cbind(timescale$b_age, timescale$t_age), 1, mean), 'nPkg'=NA, 'nColl'=NA, 'nFossiliferous'=NA, 'nTrunc'=NA, 'nInit'=NA)
for(i in 1:nBins) {
tempPkg <- subset(packages, b_age > timescale$t_age[i] & t_age < timescale$b_age[i])
summaryData$nPkg[i] <- nrow(tempPkg)
summaryData$nColl[i] <- sum(tempPkg$pbdb_collections)
summaryData$nFossiliferous[i] <- nrow(subset(tempPkg, pbdb_collections > 0))
tempTrunc <- subset(tempPkg, t_age >= timescale$t_age[i] & t_age < timescale$b_age[i])
summaryData$nTrunc[i] <- nrow(tempTrunc)
tempInit <- subset(tempPkg, b_age > timescale$t_age[i] & b_age <= timescale$b_age[i])
summaryData$nInit[i] <- nrow(tempInit)
}
runApp()
runApp('~/Documents/shinypaleo/stromModel')
runApp()
summaryData
head(summaryData)
tail(summaryData)
x <- c(0,0,0,5,6,7,0,9,8,0,0,9,8,7,0,0,0,0)
x
cumsum(x)
cumsum(rev(x))
rev(cumsum(rev(x)))
head(timescale)
summaryData <- data.frame('interval'=timescale$name, 'ageBottom'=timescale$b_age, 'ageTop'=timescale$t_age, 'ageMid'=apply(cbind(timescale$b_age, timescale$t_age), 1, mean), 'nPkg'=NA, 'nColl'=NA, 'nFossiliferous'=NA, 'nTrunc'=NA, 'nInit'=NA)
for(i in 1:nBins) {
tempPkg <- subset(packages, b_age > timescale$t_age[i] & t_age < timescale$b_age[i])
summaryData$nPkg[i] <- nrow(tempPkg)
summaryData$nColl[i] <- sum(tempPkg$pbdb_collections)
summaryData$nFossiliferous[i] <- nrow(subset(tempPkg, pbdb_collections > 0))
tempTrunc <- subset(tempPkg, t_age >= timescale$t_age[i] & t_age < timescale$b_age[i])
summaryData$nTrunc[i] <- nrow(tempTrunc)
tempInit <- subset(tempPkg, b_age > timescale$t_age[i] & b_age <= timescale$b_age[i])
summaryData$nInit[i] <- nrow(tempInit)
}
runApp()
head(timescale)
head(subset(timescale, b_age >= 0.0117))
head(subset(timescale, t_age >= 0.0117))
runApp()
head(packages)
